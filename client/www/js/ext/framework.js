(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},n=[].slice;define(["core/util","core/dom","core/mvc","core/template","core/routing","core/store","core/dev"],function(e,r,i,s,o,u,a){var f,l,c,h,p,d,v,m,g,y;return d=new u,s.registerHelper("safe",function(e){return new s.SafeString(e)}),s.addSubView=function(e){return d.set(e.cid,e),new s.SafeString('<view data-cid="'+e.cid+'"></view>')},s.renderSubView=function(e){var t;return(t=d.get(e))?(d["delete"](e),t.render().el):(a.warn("Could not render subView "+e),"")},s.renderSubViews=function(e){return e.find("view").each(function(t,n){var i;return i=r.find(n,e),i.replaceWith(s.renderSubView(i.data("cid")))})},s.registerHelper("subView",s.addSubView),c=function(e){function r(){return v=r.__super__.constructor.apply(this,arguments),v}return t(r,e),r.prototype.loadedPages={},r.prototype.initialize=function(){return this._bindPageRoutes()},r.prototype._bindPageRoutes=function(){var e,t,n,r,i;if(!this.pageRoutes)return;this.pageRoutes=_.result(this,"pageRoutes"),r=_.keys(this.pageRoutes),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this._bindPageRoute(e));return i},r.prototype._bindPageRoute=function(e){var t=this;return this.route(e,this.pageRoutes[e],function(){var r;return r=1<=arguments.length?n.call(arguments,0):[],r.unshift(t.pageRoutes[e]),t.loadPage.apply(t,r)})},r.prototype.loadPage=function(){var e,t,r,i=this;return r=arguments[0],t=2<=arguments.length?n.call(arguments,1):[],t.unshift(this.current),(e=this.loadedPages[r])?this.startPage(e,t):require(["pages/"+r],function(e){return i.loadedPages[r]=e,i.startPage(e,t)})},r.prototype.startPage=function(e,t){var n;return(n=this.current)!=null&&typeof n.stop=="function"&&n.stop(),this.current=new e,this.current.start.apply(this.current,t)},r.prototype.setPage=function(e,t,n){var r;t==null&&(t="/"),n==null&&(n={}),this.current=e,this.navigate(t,n);if(n.start)return typeof (r=this.current).start=="function"?r.start(n.args):void 0},r}(o.Router),l=function(e){function n(e){var t,r,i,s;e==null&&(e={});if((t=e.id||e.cid)&&(i=this.store.get(t)))return i.set(e,{silent:!0}),i;n.__super__.constructor.call(this,e),r=(s=this.id)!=null?s:this.cid,this.store.set(r,this)}return t(n,e),n.prototype.store=new u,n.prototype.emit=function(){return this.trigger.apply(this,arguments)},n.prototype.parse=function(e){return e.status==="OK"?e.data:{}},n}(i.Model),f=function(e){function n(){return m=n.__super__.constructor.apply(this,arguments),m}return t(n,e),n.prototype.emit=function(){return this.trigger.apply(this,arguments)},n.prototype.parse=function(e){return e.status==="OK"?e.data:{}},n}(i.Collection),h=function(e){function n(){return g=n.__super__.constructor.apply(this,arguments),g}return t(n,e),n.prototype.initialize=function(e){var t;e==null&&(e={}),e.model&&!(e.model instanceof i.Model)&&(this.Model?this.model=new this.Model(e.model):a.error("Invalid model",e.model)),e.collection&&!(e.collection instanceof i.Collection)&&(this.Collection?this.collection=new this.Collection(e.collection):a.error("Invalid collection",e.collection));if(!e.el&&e.cid){t=r.find("[data-view="+e.cid+"]");if(t.length)return this.setElement(t)}},n.prototype.emit=function(){return this.trigger.apply(this,arguments)},n.prototype.renderer=function(e){return this.$el.attr("data-view",this.cid).html(e),s.renderSubViews(this.$el),this},n}(i.View),p=function(e){function n(){return y=n.__super__.constructor.apply(this,arguments),y}return t(n,e),n.prototype.contructor=function(e){return n.__super__.contructor.call(this,e),this.stop()},n.prototype.start=function(){return this.rendered?this.delegateEvents():(this.render(),this.rendered=!0)},n.prototype.stop=function(){return this.undelegateEvents()},n}(h),i={Model:l,View:h,Collection:f},o.Router=c,{mvc:i,template:s,routing:o,Widget:p}})}).call(this);