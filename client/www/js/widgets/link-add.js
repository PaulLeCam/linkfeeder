/* ========================================================================
 * Bootstrap: button.js v3.0.3
 * http://getbootstrap.com/javascript/#buttons
 * ========================================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ======================================================================== */

(function(){define("services/page-infos",["sandbox/service"],function(e){return function(t){return e.http.post("/default/infos",{uri:t})}})}).call(this),+function(e){var t=function(n,r){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,r)};t.DEFAULTS={loadingText:"loading..."},t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.is("input")?"val":"html",i=n.data();e+="Text",i.resetText||n.data("resetText",n[r]()),n[r](i[e]||this.options[e]),setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons"]'),t=!0;if(e.length){var n=this.$element.find("input");n.prop("type")==="radio"&&(n.prop("checked")&&this.$element.hasClass("active")?t=!1:e.find(".active").removeClass("active")),t&&n.prop("checked",!this.$element.hasClass("active")).trigger("change")}t&&this.$element.toggleClass("active")};var n=e.fn.button;e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("bs.button"),s=typeof n=="object"&&n;i||r.data("bs.button",i=new t(this,s)),n=="toggle"?i.toggle():n&&i.setState(n)})},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=n,this},e(document).on("click.bs.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle"),t.preventDefault()})}(jQuery),define("bootstrap-button",["jquery"],function(){}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("widgets/link-add",["sandbox/widget","models/link","services/page-infos","bootstrap-button"],function(e,n,r){var i,s;return i=function(i){function o(){return s=o.__super__.constructor.apply(this,arguments),s}return t(o,i),o.prototype.events={submit:"handleForm",reset:"handleReset"},o.prototype.initialize=function(t){this.options=t!=null?t:{},this.$uri=this.$("#link-uri"),this.$title=this.$("#link-title"),this.$desc=this.$("#link-description"),this.$image=this.$(".link-image"),this.$btnSubmit=this.$("button[type=submit]"),this.$btnReset=this.$("button[type=reset]"),this.$formContainer=this.$(".link-extra"),this.progressPromise=e.widgets.initialize("progress-bar",{el:"#link-progress",duration:3e3});if(this.options.uri!=null&&this.options.uri.length)return this.$uri.val(this.options.uri),this.loadInfos(this.options.uri)},o.prototype.remove=function(){return e.widgets.remove("#link-progress"),o.__super__.remove.call(this)},o.prototype.handleReset=function(){return this.$uri.prop("disabled",!1),this.$btnSubmit.button("reset"),this.$formContainer.addClass("hide"),this.$btnReset.addClass("hide"),delete this.model},o.prototype.handleForm=function(){var t,n=this;return t=this.$uri.val(),t==null||!t.length?!1:(this.model?(this.$btnSubmit.button("loading"),this.model.save({title:this.$title.val(),description:this.$desc.val()}).always(function(){return n.$btnSubmit.button("reset")}).fail(function(t){return e.dev.error(t)}).done(function(){return e.emit("link:create",n.model),delete n.model,n.$el[0].reset()})):this.loadInfos(t),!1)},o.prototype.loadInfos=function(t){var i=this;return this.$uri.prop("disabled",!0),this.$btnSubmit.button("loading"),this.progressPromise.done(function(e){return e.start()}),r(t).always(function(){return i.$btnSubmit.button("reset"),i.progressPromise.done(function(e){return e.stop()})}).fail(function(){return e.dev.error("Could not load info")}).done(function(r){return i.$btnSubmit.text("Create link"),i.model=new n(e.util.extend({uri:t},r.meta)),i.$formContainer.removeClass("hide"),i.$btnReset.removeClass("hide"),i.$title.val(i.model.get("title")),i.$desc.val(i.model.get("description"))}),!1},o}(e.Widget)})}.call(this);