(function(){var e=[].slice;define(["sandbox/component","./mvc-factory"],function(t,n){var r;return r=function(){function r(e){e==null&&(e={});if(!(this instanceof r))return new r(e);this.config=new t.Store,this.instances=new t.Store,this.configure(e)}return r.prototype.configure=function(e){var n,r,i,s,o;e==null&&(e={});if(t.util.isArray(e))for(s=0,o=e.length;s<o;s++)n=e[s],this.config.set(n.key,n);else for(r in e)i=e[r],this.config.set(r,i);return this},r.prototype.initialize=function(n){var r,i,s,o,u,a;r=t.deferred();if(n!=null)if(t.util.isArray(n)){s=[];for(u=0,a=n.length;u<a;u++){i=n[u];if(o=this.config.get(i))o.key==null&&(o.key=i),s.push(this.instanciate(o))}}else if(_.isString(n))(o=this.config.get(i))?(o.key==null&&(o.key=i),s=[this.instanciate(o)]):r.reject(new Error("Could not initialize undefined key `"+n+"`"));else if(_.isObject(n)){s=[];for(i in n)o=n[i],this.config.set(i,o),o.key==null&&(o.key=i),s.push(this.instanciate(o))}else r.reject(new Error("Unhandled initialize argument"));else{s=[];for(i in n)o=n[i],o.key==null&&(o.key=i),s.push(this.instanciate(o))}return s!=null&&s.length?t.when.apply(t,s).then(function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],r.resolve(t)},r.reject):r.resolve(),r.promise()},r.prototype.instanciate=function(e){return n.instanciate(e)},r.prototype.get=function(e,n){var r,i;return n==null&&(n={}),i=t.deferred(),_.isObject(e)?this.instanciate(e).pipe(i.resolve,i.reject):this.instances.has(e)?i.resolve(this.instances.get(e)):this.config.has(e)?(r=this.config.get(e),_.isObject(r)&&r.load!=null?(r.key==null&&(r.key=e),this.instanciate(r).pipe(i.resolve,i.reject)):i.resolve(r)):(n.key==null&&(n.key=e),this.instanciate(n).pipe(i.resolve,i.reject)),i.promise()},r.prototype.set=function(e,n){var r,i;if(t.util.isObject(e))for(i in e)r=e[i],this._set(i,v);else this._set(e,n);return this},r.prototype._set=function(e,n){if(!n)return;return n instanceof t.mvc.Model||n instanceof t.mvc.Collection?this.instances.set(e,n):this.config.set(e,n)},r}()})}).call(this);