/*

  Harvey, A Second Face for Your Application's JavaScript

  Copyright 2012, Joschka Kintscher
  Released under the MIT License

  https://github.com/harvesthq/harvey/
*/

(function(){var e,t,n=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};this.Harvey=function(){function r(){}return r.states={},r.attach=function(t,n){var r;return this.states.hasOwnProperty(t)||(this.states[t]=[],this._add_css_for(t)),r=new e(t,n!=null?n.setup:void 0,n!=null?n.on:void 0,n!=null?n.off:void 0),this.states[t].length||this._watch_query(t),this.states[t].push(r),this._window_matchmedia(t).matches&&this._update_states([r],!0),r},r.detach=function(e){var t,n,r,i,s,o;s=this.states[e.condition],o=[];for(t=r=0,i=s.length;r<i;t=++r)n=s[t],e===n?o.push(this.states[n.condition][t]=void 0):o.push(void 0);return o},r._watch_query=function(e){var t=this;return this._window_matchmedia(e).addListener(function(n){return t._update_states(t.states[e],n.matches)})},r._update_states=function(e,t){var n,r,i,s;s=[];for(r=0,i=e.length;r<i;r++)n=e[r],t?s.push(n.activate()):s.push(n.deactivate());return s},r._mediaList={},r._window_matchmedia=function(e){return window.matchMedia&&n.call(window.matchMedia("all"),"addListener")>=0?(e in this._mediaList||(this._mediaList[e]=window.matchMedia(e)),this._mediaList[e]):(this._listening||this._listen(),e in this._mediaList||(this._mediaList[e]=new t(e)),this._mediaList[e])},r._listen=function(){var e,t=this;return e=window.addEventListener||window.attachEvent,e("resize",function(){var e,n,r,i;r=t._mediaList,i=[];for(n in r)e=r[n],i.push(e._process());return i}),e("orientationChange",function(){var e,n,r,i;r=t._mediaList,i=[];for(n in r)e=r[n],i.push(e._process());return i}),this._listening=!0},r._add_css_for=function(e){this.style||(this.style=document.createElement("style"),this.style.setAttribute("type","text/css"),document.getElementsByTagName("head")[0].appendChild(this.style)),e="@media "+e+" {.harvey-test{}}";if(!this.style.styleSheet)return this.style.appendChild(document.createTextNode(e))},r}(),e=function(){function e(e,t,n,r){this.condition=e,this.setup=t,this.on=n,this.off=r}return e.prototype.active=!1,e.prototype.is_setup=!1,e.prototype.activate=function(){if(this.active)return;return this.is_setup||(typeof this.setup=="function"&&this.setup(),this.is_setup=!0),typeof this.on=="function"&&this.on(),this.active=!0},e.prototype.deactivate=function(){if(!this.active)return;return typeof this.off=="function"&&this.off(),this.active=!1},e}(),t=function(){function e(e){this.media=e,this._listeners=[],this.matches=this._matches()}return e.prototype.addListener=function(e){return this._listeners.push(e),void 0},e.prototype._process=function(){var e,t,n,r,i,s;t=this._matches();if(this.matches===t)return;this.matches=t,i=this._listeners,s=[];for(n=0,r=i.length;n<r;n++)e=i[n],s.push(e(this));return s},e.prototype._matches=function(){return this._tester||this._get_tester(),this._tester.innerHTML='&shy;<style media="'+this.media+'">#harvey-mq-test{width:42px;}</style>',this._tester.removeChild(this._tester.firstChild),this._tester.offsetWidth===42},e.prototype._get_tester=function(){this._tester=document.getElementById("harvey-mq-test");if(!this._tester)return this._build_tester()},e.prototype._build_tester=function(){return this._tester=document.createElement("div"),this._tester.id="harvey-mq-test",this._tester.style.cssText="position:absolute;top:-100em",document.body.insertBefore(this._tester,document.body.firstChild)},e}()}).call(this);